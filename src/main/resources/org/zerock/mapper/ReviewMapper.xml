<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
		
<mapper namespace="org.zerock.mapper.ReviewMapper">

	<insert id="insertReview" parameterType="org.zerock.domain.ReviewVO">
		<selectKey order="BEFORE" keyProperty="mno" resultType="int">
			select mno from t_member where mid = #{mid}
		</selectKey>
	
		insert into t_review (mid, title, code, comment, rating, imgLink, mno)
		values (#{mid}, #{title}, #{code}, #{comment}, #{rating}, #{imgLink}, #{mno})
	</insert>
	
	<sql id="criteria">
		<if test="type !='' and keyword !=''">
			<where>
					<if test="type eq 'w'.toString()">
						mid like concat ('%',#{keyword},'%' )
					</if>

					<if test="type eq 't'.toString()">
						title like concat ('%',#{keyword},'%')
					</if>
			</where>
		</if>
	</sql>
	
	<select id="listReviews" resultType="org.zerock.domain.ReviewVO">
	select * from t_review
	
	<include refid="criteria"></include>
	
	order by vno desc limit #{pageStart},#{perPageNum}
	</select>  
	
	<delete id="deleteReview">
	delete from t_review where vno = #{vno}
	</delete>
	
	<select id="countReview" resultType="int">
		select count(*) from t_review
		<include refid="criteria"></include>
	</select>
	
</mapper>