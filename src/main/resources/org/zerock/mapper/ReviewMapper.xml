<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
		
<mapper namespace="org.zerock.mapper.ReviewMapper">

	<!-- 리뷰 등록 -->
	<insert id="insertReview">
	insert into t_review (mid, title, comment, rating, imgLink)
	values (#{mid}, #{title}, #{comment}, #{rating}, #{imgLink})
	</insert>
	
	
	<!-- 검색 Criteria -->
	<sql id="criteria">
		<if test="type !='' and keyword !=''">
			<where>
					<if test="type eq 'w'.toString()">
						mid like concat ('%',#{keyword},'%' )
					</if>

					<if test="type eq 't'.toString()">
						title like concat ('%',#{keyword},'%')
					</if>
			</where>
		</if>
	</sql>
	
	<!-- 리뷰 리스트 -->
	<select id="listReviews" resultType="org.zerock.domain.ReviewVO">
	select * from t_review
	
	<include refid="criteria"></include>
	
	order by vno desc limit #{pageStart},#{perPageNum}
	</select>  
	
	<!-- 리뷰 삭제 -->
	<delete id="deleteReview">
	delete from t_review where vno = #{vno}
	</delete>
	
	<!-- 리뷰 총 갯수 -->
	<select id="countReview" resultType="int">
		select count(*) from t_review
		<include refid="criteria"></include>
	</select>
	
</mapper>